<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- For responsiveness -->
  <title>Plastic Classifier Demo</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>♻️</text></svg>"> <!-- Simple favicon -->
  <!-- TensorFlow.js (required dependency) -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
  <!-- Teachable Machine -->
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <style>
    :root { --primary: #4CAF50; --accent: #2196F3; --bg: #f4f4f4; --text: #333; }
    body { font-family: 'Arial', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
    .container { max-width: 500px; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); text-align: center; transition: transform 0.2s; }
    .container:hover { transform: translateY(-5px); }
    h1 { color: var(--primary); margin-bottom: 20px; }
    input[type="file"] { margin: 20px 0; padding: 10px; border: 2px dashed var(--accent); border-radius: 8px; width: 100%; cursor: pointer; }
    #preview { width: 100%; max-width: 300px; height: auto; border: 1px solid #ddd; border-radius: 8px; margin: 10px 0; display: none; }
    #label-container { font-size: 1.2em; font-weight: bold; color: var(--primary); margin: 20px 0; padding: 10px; background: #e8f5e9; border-radius: 8px; }
    .loading { display: none; font-style: italic; color: #888; }
    button { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-top: 10px; transition: background 0.3s; }
    button:hover { background: #1976D2; }
    @media (max-width: 600px) { .container { padding: 20px; } } /* Responsive for mobile */
  </style>
</head>
<body>
  <main class="container">
    <h1>SDG SCANNER</h1>
    <p>Upload an image of plastic to classify it as Biodegradable, Recyclable, or Non-Recyclable.</p>
    <input type="file" id="upload" accept="image/*" aria-label="Upload plastic image">
    <img id="preview" src="#" alt="Preview of uploaded plastic image" style="display:none;">
    <button id="predict">Predict</button>
    <div id="label-container">Awaiting image upload…</div>
    <div class="loading" id="loading">Loading model...</div>
    <button id="reset">Reset</button>
  </main>
  <script type="text/javascript">
    const MODEL_URL = "https://ankurcodetesting.github.io/plastic-detector/model.json";

    let model;
    const upload = document.getElementById('upload');
    const preview = document.getElementById('preview');
    const labelContainer = document.getElementById('label-container');
    const loading = document.getElementById('loading');
    const predictBtn = document.getElementById('predict');
    const resetBtn = document.getElementById('reset');

    async function loadModel() {
      loading.style.display = 'block';
      labelContainer.textContent = "Loading model...";
      try {
        const tm = window.tmImage;
        model = await tm.load(MODEL_URL, MODEL_URL.replace("model.json", "metadata.json"));
        labelContainer.textContent = "Model loaded! Upload an image.";
      } catch (error) {
        labelContainer.textContent = "Error loading model. Check console.";
        console.error(error);
      } finally {
        loading.style.display = 'none';
      }
    }
    loadModel();

    upload.addEventListener('change', async (evt) => {
      const file = evt.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        preview.src = e.target.result;
        preview.style.display = 'block';
        labelContainer.textContent = "Image uploaded! Click Predict.";
      };
      reader.readAsDataURL(file);
    });

    predictBtn.addEventListener('click', async () => {
      if (!model) return labelContainer.textContent = "Model not loaded yet.";
      if (preview.style.display === 'none') return labelContainer.textContent = "Upload an image first!";
      labelContainer.textContent = "Predicting...";
      try {
        const prediction = await model.predict(preview);
        let results = prediction
          .map(p => `${p.className}: ${(p.probability * 100).toFixed(1)}%`)
          .join("<br>");
        labelContainer.innerHTML = results;
      } catch (error) {
        labelContainer.textContent = "Prediction failed. Try again.";
        console.error(error);
      }
    });

    resetBtn.addEventListener('click', () => {
      preview.style.display = 'none';
      preview.src = '#';
      labelContainer.textContent = "Awaiting image upload…";
      upload.value = '';
    });
  </script>
</body>
</html>
